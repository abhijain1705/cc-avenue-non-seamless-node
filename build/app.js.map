{"version":3,"file":"app.js","names":["crypto","require","qs","CCAvenueNonSeamlessNode","options","_classCallCheck2","initOptions","_createClass2","key","value","getAlgorithm","keyBase64","Buffer","from","length","Error","decrypt","messagebase64","ivBase64","iv","decipher","createDecipheriv","decrypted","update","encrypt","plainText","cipher","createCipheriv","encrypted","postRes","data","workingKeyInput","ccavEncResponse","ccavResponse","workingKey","ccavPOST","jsonObject","md5","createHash","digest","toString","parse","encryption","encResp","ccav","console","log","getPaymentUrl","accessCodeInput","body","accessCode","encRequest","concat","module","exports"],"sources":["../app.js"],"sourcesContent":["const crypto = require(\"crypto\");\r\nconst qs = require(\"querystring\");\r\n\r\nclass CCAvenueNonSeamlessNode {\r\n  constructor(options) {\r\n    this.initOptions = options || {};\r\n  }\r\n\r\n  getAlgorithm(keyBase64) {\r\n    const key = Buffer.from(keyBase64, \"base64\");\r\n    switch (key.length) {\r\n      case 16:\r\n        return \"aes-128-cbc\";\r\n      case 32:\r\n        return \"aes-256-cbc\";\r\n    }\r\n    throw new Error(\"Invalid key length: \" + key.length);\r\n  }\r\n\r\n  decrypt(messagebase64, keyBase64, ivBase64) {\r\n    const key = Buffer.from(keyBase64, \"base64\");\r\n    const iv = Buffer.from(ivBase64, \"base64\");\r\n\r\n    const decipher = crypto.createDecipheriv(getAlgorithm(keyBase64), key, iv);\r\n    let decrypted = decipher.update(messagebase64, \"hex\");\r\n    decrypted += decipher.final();\r\n    return decrypted;\r\n  }\r\n\r\n  encrypt(plainText, keyBase64, ivBase64) {\r\n    const key = Buffer.from(keyBase64, \"base64\");\r\n    const iv = Buffer.from(ivBase64, \"base64\");\r\n\r\n    const cipher = crypto.createCipheriv(getAlgorithm(keyBase64), key, iv);\r\n    let encrypted = cipher.update(plainText, \"utf8\", \"hex\");\r\n    encrypted += cipher.final(\"hex\");\r\n    return encrypted;\r\n  }\r\n\r\n  postRes(data, workingKeyInput) {\r\n    var ccavEncResponse = data,\r\n      ccavResponse = \"\",\r\n      workingKey = workingKeyInput, //Put in the 32-Bit key shared by CCAvenues.\r\n      ccavPOST = \"\",\r\n      jsonObject = {};\r\n\r\n    //Generate Md5 hash for the key and then convert in base64 string\r\n    var md5 = crypto.createHash(\"md5\").update(workingKey).digest();\r\n    var keyBase64 = Buffer.from(md5).toString(\"base64\");\r\n\r\n    //Initializing Vector and then convert in base64 string\r\n    var ivBase64 = Buffer.from([\r\n      0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,\r\n      0x0c, 0x0d, 0x0e, 0x0f,\r\n    ]).toString(\"base64\");\r\n\r\n    ccavPOST = qs.parse(ccavEncResponse);\r\n    var encryption = ccavPOST.encResp;\r\n    ccavResponse = ccav.decrypt(encryption, keyBase64, ivBase64);\r\n    jsonObject = qs.parse(ccavResponse);\r\n    console.log(jsonObject, \"efdcs\");\r\n\r\n    return jsonObject;\r\n  }\r\n\r\n  getPaymentUrl(data, accessCodeInput, workingKeyInput) {\r\n    // order params\r\n    var body = data,\r\n      workingKey = workingKeyInput, //Put in the 32-Bit key shared by CCAvenues.\r\n      accessCode = accessCodeInput, //Put in the Access Code shared by CCAvenues.\r\n      encRequest = \"\";\r\n\r\n    //Generate Md5 hash for the key and then convert in base64 string\r\n    var md5 = crypto.createHash(\"md5\").update(workingKey).digest();\r\n    var keyBase64 = Buffer.from(md5).toString(\"base64\");\r\n\r\n    //Initializing Vector and then convert in base64 string\r\n    var ivBase64 = Buffer.from([\r\n      0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,\r\n      0x0c, 0x0d, 0x0e, 0x0f,\r\n    ]).toString(\"base64\");\r\n\r\n    encRequest = ccav.encrypt(body, keyBase64, ivBase64);\r\n    return `https://secure.ccavenue.com/transaction/transaction.do?command=initiateTransaction&encRequest=${encRequest}&access_code=${accessCode}`;\r\n  }\r\n}\r\n\r\nmodule.exports = CCAvenueNonSeamlessNode;\r\n"],"mappings":"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","ignoreList":[]}